{% layout none %}

<!DOCTYPE html>
<html>
<head>
  <style>
    table {
      width: 100%;
      border-collapse: collapse;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: left;
    }
    th {
      background-color: #f2f2f2;
    }
    .quantity-input {
      width: 60px;
    }
  </style>
</head>
<body>

<h1>Shopify Cart Builder</h1>

<form id="urlBuilderForm">
  <table>
    <thead>
      <tr>
        <th>Select</th>
        <th>Name</th>
        <th>Variant ID</th>
        <th>Quantity</th>
      </tr>
    </thead>
    <tbody>
      {% for product in collections.all.products %}
        {% for variant in product.variants %}
          <tr>
            <td><input type="checkbox" name="variant" value="{{ variant.id }}"></td>
            <td>
              {{ product.title }}
              {% if product.variants.size > 1 and variant.title != 'Default Title' %}
                - {{ variant.title }}
              {% endif %}
            </td>
            <td>{{ variant.id }}</td>
            <td><input type="number" name="quantity_{{ variant.id }}" value="1" min="1" class="quantity-input"></td>
          </tr>
        {% endfor %}
      {% endfor %}
    </tbody>
  </table>
  
  <label for="sendVisitorTo">Send visitor to:</label>
  <select id="sendVisitorTo" name="sendVisitorTo">
    <option value="cart">Cart</option>
    <option value="checkout">Checkout</option>
  </select><br>

  <label for="discountCode">Discount Code:</label>
  <input type="text" id="discountCode" name="discountCode"><br>

  <input type="button" value="Build URL" onclick="buildUrl()">
</form>

<p>Generated URL:</p>
<textarea id="generatedUrl" rows="4" cols="50" readonly></textarea>

<p>QR Code:</p>
<img id="qrCodeImage" src="" alt="QR Code" style="display:none;">

<script>
  function buildUrl() {
    var variants = document.querySelectorAll('input[name="variant"]:checked');
    var baseUrl = "https://" + "{{ shop.permanent_domain }}/cart";
    var cartItems = [];

    variants.forEach(function(variant) {
      var quantity = document.querySelector('input[name="quantity_' + variant.value + '"]').value;
      cartItems.push(variant.value + ':' + quantity);
    });

    var url = baseUrl + (cartItems.length > 0 ? '/' + cartItems.join(',') : '');

    var queryParams = [];
    var discountCode = document.getElementById('discountCode').value.trim();
    if (discountCode) {
      queryParams.push('discount=' + encodeURIComponent(discountCode));
    }

    var sendVisitorTo = document.getElementById('sendVisitorTo').value;
    if (sendVisitorTo === "cart") {
      queryParams.push('storefront=true');
    } else if (sendVisitorTo === "checkout") {
      queryParams.push('storefront=false');
    }

    if (queryParams.length > 0) {
      url += '?' + queryParams.join('&');
    }

    document.getElementById('generatedUrl').value = url;

    // Generate QR code using Google Charts
    var qrImageUrl = 'https://chart.googleapis.com/chart?cht=qr&chl=' + encodeURIComponent(url) + '&chs=180x180&choe=UTF-8&chld=L|2';
    document.getElementById('qrCodeImage').src = qrImageUrl;
    document.getElementById('qrCodeImage').style.display = 'block';
  }
</script>

</body>
</html>

